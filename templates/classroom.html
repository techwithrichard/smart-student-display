{% extends "base.html" %}

{% block title %}{{ classroom.name }} - Classroom{% endblock %}

{% block content %}
<div class="container">
    <div class="classroom-header">
        <h1>{{ classroom.name }}</h1>
        <p class="classroom-code-display">Classroom Code: <strong>{{ classroom.code }}</strong></p>
    </div>
    
    <div class="classroom-layout">
        <div class="classroom-main">
            <div class="section-header">
                <h2>Projects Gallery</h2>
                {% if current_user.role == 'student' %}
                    <a href="{{ url_for('upload_project') }}" class="btn btn-primary">Upload Project</a>
                {% endif %}
            </div>
            
            {% if projects %}
                <div class="projects-gallery">
                    {% for project in projects %}
                        <div class="project-card-gallery">
                            <div class="project-header">
                                <h3>{{ project.title }}</h3>
                                <span class="project-type-badge">{{ project.project_type|upper }}</span>
                            </div>
                            <p class="project-description">{{ project.description[:150] }}{% if project.description|length > 150 %}...{% endif %}</p>
                            <div class="project-stats">
                                <span>{{ project.likes }} likes</span>
                                <span>{{ project.views }} views</span>
                                <span>By {{ project.student.username }}</span>
                            </div>
                            <a href="{{ url_for('view_project', project_id=project.id) }}" class="btn btn-secondary">View Project</a>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>No projects yet. Be the first to upload one!</p>
                </div>
            {% endif %}
            
            <div class="section-header">
                <h2>Subjects</h2>
                {% if current_user.role == 'admin' %}
                    <a href="{{ url_for('add_subject', classroom_id=classroom.id) }}" class="btn btn-primary">Add Subject</a>
                {% endif %}
            </div>
            
            {% if subjects %}
                <div class="subjects-grid">
                    {% for subject in subjects %}
                        <div class="subject-card">
                            <h3>{{ subject.name }}</h3>
                            <p class="subject-teacher">Teacher: {{ subject.teacher.username }}</p>
                            <a href="{{ url_for('view_subject', subject_id=subject.id) }}" class="btn btn-secondary">View Subject</a>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>No subjects yet.{% if current_user.role == 'admin' %} Add subjects to organize assignments!{% endif %}</p>
                </div>
            {% endif %}
            
            <div class="section-header">
                <h2>Challenges</h2>
                {% if current_user.role == 'teacher' %}
                    <a href="{{ url_for('create_challenge') }}" class="btn btn-primary">Create Challenge</a>
                {% endif %}
            </div>
            
            {% if challenges %}
                <div class="challenges-list">
                    {% for challenge in challenges %}
                        <div class="challenge-card">
                            <div class="challenge-header">
                                <h3>{{ challenge.title }}</h3>
                                <span class="challenge-points">{{ challenge.points }} points</span>
                            </div>
                            <p>{{ challenge.description }}</p>
                            {% if current_user.role == 'student' %}
                                <form method="POST" action="{{ url_for('submit_challenge', challenge_id=challenge.id) }}" class="challenge-submit-form">
                                    <select name="project_id" required>
                                        <option value="">Select your project</option>
                                        {% for project in projects %}
                                            {% if project.student_id == current_user.id %}
                                                <option value="{{ project.id }}">{{ project.title }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                    <button type="submit" class="btn btn-primary">Submit</button>
                                </form>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-state">
                    <p>No challenges yet.{% if current_user.role == 'teacher' %} Create one to engage your students!{% endif %}</p>
                </div>
            {% endif %}
        </div>
        
        <div class="classroom-sidebar">
            {% if current_user.role in ['teacher', 'admin'] or (current_user.role == 'staff' and classroom.teacher_id == current_user.id) %}
                <div class="students-card">
                    <div class="section-header">
                        <h2>Students</h2>
                        <a href="{{ url_for('add_student_to_classroom', classroom_id=classroom.id) }}" class="btn btn-small btn-primary">Add Student</a>
                    </div>
                    {% if classroom.students %}
                        <ul class="students-list">
                            {% for enrollment in classroom.students %}
                                <li class="student-item">
                                    <div class="student-info">
                                        <span class="student-name">{{ enrollment.student.username }}</span>
                                        <span class="student-points">{{ enrollment.points }} pts</span>
                                    </div>
                                    {% if current_user.role in ['teacher', 'admin'] or (current_user.role == 'staff' and classroom.teacher_id == current_user.id) %}
                                        <form method="POST" action="{{ url_for('remove_student_from_classroom', classroom_id=classroom.id, student_id=enrollment.student.id) }}" style="display: inline;" onsubmit="return confirm('Remove {{ enrollment.student.username }} from this classroom?')">
                                            <button type="submit" class="btn btn-small btn-danger">Remove</button>
                                        </form>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p class="empty-state">No students enrolled yet</p>
                    {% endif %}
                </div>
            {% endif %}
            
            <div class="leaderboard-card">
                <h2>Leaderboard</h2>
                {% if leaderboard %}
                    <ol class="leaderboard-list">
                        {% for entry in leaderboard %}
                            <li>
                                <span class="leaderboard-name">{{ entry.username }}</span>
                                <span class="leaderboard-points">{{ entry.points }} pts</span>
                            </li>
                        {% endfor %}
                    </ol>
                {% else %}
                    <p class="empty-state">No leaderboard data yet</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
